# Makefile for uClibc
#
# Copyright (C) 2000-2005 Erik Andersen <andersen@uclibc.org>
#
# Licensed under the LGPL v2.1, see the file COPYING.LIB in this tarball.
#

# order is relevant
-include $(top_srcdir)libc/string/$(TARGET_ARCH)/Makefile.arch
include $(top_srcdir)libc/string/generic/Makefile.in

STRING_DIR:=$(top_srcdir)libc/string
STRING_OUT:=$(top_builddir)libc/string

STRING_ALL_WXSRC:=$(wildcard $(STRING_DIR)/w*_l.c)
ifeq ($(UCLIBC_HAS_LOCALE),y)
STRING_WXSRC:=$(STRING_ALL_WXSRC)
else
# wcscoll_l
STRING_WXSRC:=$(filter-out $(STRING_DIR)/wcsxfrm_l.c,$(STRING_ALL_WXSRC))
endif

STRING_ALL_XLSRC:=$(filter-out $(STRING_ALL_WXSRC),$(wildcard $(STRING_DIR)/*_l.c))
ifeq ($(UCLIBC_HAS_LOCALE),y)
STRING_XLSRC:=$(STRING_ALL_XLSRC)
else
# strcoll_l
STRING_XLSRC:=$(filter-out $(STRING_DIR)/strxfrm_l.c,$(STRING_ALL_XLSRC))
endif

STRING_ALL_WSRC:=$(filter-out $(STRING_ALL_WXSRC),$(wildcard $(STRING_DIR)/w*.c))
ifeq ($(UCLIBC_HAS_LOCALE),y)
STRING_WSRC:=$(STRING_ALL_WSRC)
else
# wcscoll
STRING_WSRC:=$(filter-out $(STRING_DIR)/wcsxfrm.c,$(STRING_ALL_WSRC))
endif

STRING_ALL_CSRC:=$(filter-out $(STRING_ALL_WXSRC) $(STRING_ALL_XLSRC) $(STRING_ALL_WSRC) $(STRING_DIR)/_collate.c,$(wildcard $(STRING_DIR)/*.c))
ifeq ($(UCLIBC_HAS_LOCALE),y)
STRING_CSRC:=$(STRING_ALL_CSRC)
else
# strcoll
STRING_CSRC:=$(filter-out $(STRING_DIR)/strxfrm.c,$(STRING_ALL_CSRC))
endif

ifeq ($(UCLIBC_HAS_WCHAR),y)
STRING_CSRC+=$(STRING_WSRC)
endif
ifeq ($(UCLIBC_HAS_XLOCALE),y)
STRING_CSRC+=$(STRING_XLSRC)
ifeq ($(UCLIBC_HAS_WCHAR),y)
STRING_CSRC+=$(STRING_WXSRC)
endif
endif

ifeq ($(UCLIBC_HAS_STRING_ARCH_OPT),y)
ifneq ($(strip $(STRING_ARCH_OBJS)),)
STRING_CSRC:=$(filter-out $(patsubst %.o,$(STRING_DIR)/%.c,$(notdir $(STRING_ARCH_OBJS))),$(STRING_CSRC))
endif
endif

ifeq ($(UCLIBC_HAS_STRING_GENERIC_OPT),y)
ifneq ($(strip $(STRING_GENERIC_OBJS)),)
STRING_CSRC:=$(filter-out $(patsubst %.o,$(STRING_DIR)/%.c,$(notdir $(STRING_GENERIC_OBJS))),$(STRING_CSRC))
endif
endif

STRING_COBJ:=$(patsubst $(STRING_DIR)/%.c,$(STRING_OUT)/%.o,$(STRING_CSRC))

libc-a-y+=$(STRING_COBJ)
libc-so-y+=$(STRING_COBJ:.o=.os)

libc-multi-y+=$(STRING_CSRC)

objclean-y+=string_objclean

string_objclean:
	$(RM) $(STRING_OUT)/{,*/}*.{o,os}
